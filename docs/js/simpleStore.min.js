/* simplestore | Copyright 2021 Chris Diana (https://github.com/cdmedia/simplestore) | MIT license | v1.5 */

var simpleStore={products:[],plugins:{},settings:{numColumns:3,brand:"SimpleStore",mode:"JSON",JSONFile:"products.json",fadeSpeed:200,buttonColor:null,backgroundColor:null,textColor:null,container:$(".simpleStore_container"),cartContainer:$(".simpleStore_cart_container"),rowClass:"simpleStore_row_",columnWidthClasses:{1:"",2:"one-half",3:"one-third"}},productPageOptions:["OneOfAKind"],extend:function(e,t,n){for(var r in void 0===t&&(t=e,e=simpleStore),t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return n(),e},render:function(t,n){var e=t.split("/")[0],r={"":function(){simpleStore.renderProducts(simpleStore.products,n)},"#product":function(){var e=t.split("#product/")[1].trim();simpleStore.renderSingleProduct(e,n)},"#cart":function(){simpleStore.renderCart(n)}};r[e]?r[e]():simpleStore.renderError(n)},insertData:function(e,t){e.find(".item_thumb").attr("src",t.image),e.find(".item_name").text(t.name),e.find(".item_price").text(t.price),e.find(".item_description").text(t.description)},renderProducts:function(r,i){var o,a=1,c=(r.length,Math.ceil(r.length/i.numColumns));i.cartContainer.hide(),i.container.fadeOut(i.fadeSpeed,function(){i.container.html("").fadeIn(i.fadeSpeed);for(var e=0;e<c;e++)i.container.append('<div class="row '+i.rowClass+(e+1)+'"></div>');var t,n=i.columnWidthClasses;for(t in n)t==i.numColumns&&(o=n[t]);r.forEach(function(t,e){var n;t.soldOut||(n=$("#products-template").html(),(n=$(n)).first().addClass(o),simpleStore.insertData(n,t),n.find(".simpleStore_getDetail").on("click",function(e){e.preventDefault(),window.location.hash="product/"+t.id}),(e=0===e?1:e)%i.numColumns==0&&a++,$("."+i.rowClass+a).append(n))})})},renderProductOptions:function(r,e){var i="";return r.forEach(function(e){var n,t;simpleStore.productPageOptions in e?simpleStore.renderProductPageOptions(e):(n="",e=e[t=Object.keys(e)[0].trim()].trim().split(","),$(e).each(function(e,t){n+='<option value="'+t.replace(/ /g,"_").toLowerCase()+'"> '+t+" </option>"}),r.length&&(i+="<label>"+t+'</label><select class="item_'+t.replace(/ /g,"_").toLowerCase()+'">'+n+"</select>"))}),i},renderProductPageOptions:function(e){e.OneOfAKind&&$(".qty").hide()},renderSingleProduct:function(n,r){r.container.fadeOut(r.fadeSpeed,function(){var e=$("#product-detail-template").html(),t=$(e);simpleStore.products.forEach(function(e){e.id==n&&(simpleStore.insertData(t,e),r.container.html(t),e.options.length&&(e=simpleStore.renderProductOptions(e.options,r),$(".simpleStore_options").append(e)),r.container.fadeIn(r.fadeSpeed))})})},renderCart:function(e){e.container.fadeOut(e.fadeSpeed,function(){e.cartContainer.fadeIn(e.fadeSpeed)})},renderError:function(t,e){var n=$("#error-template").html(),r=$(n);t.container.html("").fadeIn(t.fadeSpeed),e.length&&r.find(".error_text").text(e),t.container.append(r),t.container.fadeIn(t.fadeSpeed),r.find(".alert_close").on("click",function(e){e.preventDefault(),r.fadeOut(t.fadeSpeed,function(){r.remove()})})},handleFailure:function(e,t){setTimeout(function(){simpleStore.renderError(e,t)},1e3)},notifier:function(e){s=this.settings;var t=$("#notify-template").html(),n=$(t);e.length&&(n.find(".notify_text").text(e),s.container.append(n),n.hide(),n.fadeIn(s.fadeSpeed),setTimeout(function(){n.fadeOut(s.fadeSpeed)},1e3))},initJSON:function(e){var t='There was an error loading the JSON file. Please make sure you have "'+e.JSONFile+'" file in your main directory.';$.get(e.JSONFile).success(function(){$.getJSON(e.JSONFile,function(e){simpleStore.setProducts(e.products)}).fail(function(){simpleStore.handleFailure(e,t)})}).fail(function(){simpleStore.handleFailure(e,t)})},checkMode:function(e){(e.hasOwnProperty("spreadsheetID")||e.hasOwnProperty("spreadsheetId"))&&(e.mode="Google")},checkout:function(e,t){$.isEmptyObject(t)||(simpleCart.checkout(),e.cartContainer.fadeOut(e.fadeSpeed,function(){e.container.html('<i class="fa fa-spin fa-circle-o-notch loader"></i>'),e.container.fadeIn(e.fadeSpeed)}))},verifyCheckoutData:function(e,t,n){for(var r in e)if(e.hasOwnProperty(r))for(var r=e[r],i=r.name,o=r.price,a=0;a<t.length;a++){var c=t[a],l=c.name,c=c.price;i===l&&o!=c&&(n=!1)}return n},validatePrices:function(t){var e,n=JSON.parse(localStorage.simpleCart_items),r="There was an error validating your cart.";"JSON"===t.mode?$.get(t.JSONFile).success(function(){$.getJSON(t.JSONFile,function(e){e=e.products;simpleStore.verifyCheckoutData(n,e,!0)?simpleStore.checkout(t,n):simpleStore.renderError(t,r)}).fail(function(){simpleStore.handleFailure(t,r)})}).fail(function(){simpleStore.handleFailure(t,r)}):(e=t.mode.toLowerCase(),simpleStore.plugins[e]&&simpleStore.plugins[e].validate(n))},setProducts:function(e,t){0<e.length&&e.forEach(function(e,t){e.id=t+1,simpleStore.products.push(e)}),$(window).trigger("hashchange")},setLayout:function(e){e.brand.match("^http://")||e.brand.match("^https://")||e.brand.match("^www.")?$(".brand").html('<img src="'+e.brand+'" />'):$(".brand").html("<h5>"+e.brand+"</h5>"),$("title").html(e.brand)},generateCart:function(e){var t=$("#cart-template").html(),t=$(t);e.cartContainer.html(t)},generateStore:function(){var t=this.settings;switch(this.checkMode(t),$(window).on("hashchange",function(){simpleStore.render(window.location.hash,t)}),t.mode){case"JSON":this.initJSON(t);break;case"Google":simpleStore.plugins.google?simpleStore.plugins.google.init(function(e){simpleStore.setProducts(e,t)}):simpleStore.renderError(t,"There was an error loading the Google plugin. Make sure it is installed properly.");break;default:this.initJSON(t)}this.generateCart(t),this.setLayout(t),$(".simpleStore_checkout").on("click",function(e){e.preventDefault(),simpleStore.validatePrices(t)}),$(".simpleStore_viewCart").on("click",function(e){e.preventDefault(),window.location="#cart"}),$(".view_close").on("click",function(e){e.preventDefault(),window.location.hash=""}),simpleCart({afterAdd:function(){simpleStore.notifier("Item added to cart")}})},init:function(e){if($.isPlainObject(e))return this.extend(this.settings,e,function(){simpleStore.generateStore()})}};